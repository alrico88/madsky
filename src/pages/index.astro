---
import MeasurementGridItem from "@components/MeasurementGridItem.astro";
import prisma from "@helpers/prisma";
import Layout from "@layouts/Layout.astro";
import { SNAPSHOTS_IN_A_WEEK } from "@helpers/time";

const page = Astro.url.searchParams.get("page") ?? 0;

const data = await prisma.skyMeasurement.findMany({
  select: {
    id: true,
    created_at: true,
    average_color: true,
    image: true,
  },
  orderBy: {
    created_at: "desc",
  },
  take: SNAPSHOTS_IN_A_WEEK,
  skip: SNAPSHOTS_IN_A_WEEK * Number(page),
});
---

<Layout
  title="MADSKY"
  description="Observa el cielo de Madrid y sus colores a lo largo de los dÃ­as"
  keywords="Madrid,cielo,color,colores"
>
  <div class="row row-cols-2 row-cols-md-4 row-cols-lg-5 g-0">
    {
      data.map((d) => {
        return (
          <div class="col">
            <MeasurementGridItem
              id={d.id}
              color={d.average_color}
              date={d.created_at}
              image={d.image}
            />
          </div>
        );
      })
    }
  </div>
  <div class="row">
    <div class="col text-center">
      <a class="btn btn-link w-100 py-3" href={`/?page=${Number(page) + 1}`}
        >Load previous</a
      >
    </div>
  </div>
</Layout>
